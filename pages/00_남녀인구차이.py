import streamlit as st
import pandas as pd

def app():
    st.title("서울시 구별 남녀 인구 비율 시각화 (2025년 5월 기준)")

    # 데이터 불러오기
    df = pd.read_csv('202505_202505_연령별인구현황_월간.csv', encoding='cp949')

    # 행정구역 이름 전처리 (시, 구, 동 정보 분리용)
    df['행정구역전체'] = df['행정구역'].copy()
    df['행정구역'] = df['행정구역'].astype(str).str.split(' ').str[0]

    # 쉼표 제거 및 정수형 변환
    df['2025년05월_남_총인구수'] = df['2025년05월_남_총인구수'].str.replace(',', '', regex=False).astype(int)
    df['2025년05월_여_총인구수'] = df['2025년05월_여_총인구수'].str.replace(',', '', regex=False).astype(int)

    # 서울시 내 데이터 필터링
    서울_df = df[df['행정구역'].str.startswith('서울특별시')].copy()

    # 구 단위로 이름 정제
    서울_df['구'] = 서울_df['행정구역전체'].str.extract(r'서울특별시\s+(\S+)')

    # 구별로 남녀 인구 합산
    구별_집계 = 서울_df.groupby('구')[['2025년05월_남_총인구수', '2025년05월_여_총인구수']].sum()
    구별_집계 = 구별_집계.dropna()  # 구 이름 없는 행 제거

    # 비율 계산
    구별_집계['남자비율(%)'] = (구별_집계['2025년05월_남_총인구수'] / 
                           (구별_집계['2025년05월_남_총인구수'] + 구별_집계['2025년05월_여_총인구수'])) * 100
    구별_집계['여자비율(%)'] = 100 - 구별_집계['남자비율(%)']

    # 시각화를 위한 데이터프레임 재구성
    비율_df = 구별_집계[['남자비율(%)', '여자비율(%)']]
    비율_df = 비율_df.round(1)

    st.subheader("서울시 구별 남녀 인구 비율 (%)")
    st.bar_chart(비율_df)

    # 데이터표도 함께 제공
    with st.expander("📋 데이터 보기"):
        st.dataframe(비율_df)

if __name__ == '__main__':
    app()

