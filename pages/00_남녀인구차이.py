import streamlit as st
import pandas as pd

def app():
    st.title("μ„μΈμ‹ κµ¬λ³„ λ‚¨λ…€ μΈκµ¬ λΉ„μ¨ μ‹κ°ν™” (2025λ…„ 5μ›” κΈ°μ¤€)")

    # λ°μ΄ν„° λ¶λ¬μ¤κΈ°
    df = pd.read_csv('202505_202505_μ—°λ Ήλ³„μΈκµ¬ν„ν™©_μ›”κ°„.csv', encoding='cp949')

    # ν–‰μ •κµ¬μ—­ μ΄λ¦„ μ „μ²λ¦¬ (μ‹, κµ¬, λ™ μ •λ³΄ λ¶„λ¦¬μ©)
    df['ν–‰μ •κµ¬μ—­μ „μ²΄'] = df['ν–‰μ •κµ¬μ—­'].copy()
    df['ν–‰μ •κµ¬μ—­'] = df['ν–‰μ •κµ¬μ—­'].astype(str).str.split(' ').str[0]

    # μ‰Όν‘ μ κ±° λ° μ •μν• λ³€ν™
    df['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'] = df['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'].str.replace(',', '', regex=False).astype(int)
    df['2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ'] = df['2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ'].str.replace(',', '', regex=False).astype(int)

    # μ„μΈμ‹ λ‚΄ λ°μ΄ν„° ν•„ν„°λ§
    μ„μΈ_df = df[df['ν–‰μ •κµ¬μ—­'].str.startswith('μ„μΈνΉλ³„μ‹')].copy()

    # κµ¬ λ‹¨μ„λ΅ μ΄λ¦„ μ •μ 
    μ„μΈ_df['κµ¬'] = μ„μΈ_df['ν–‰μ •κµ¬μ—­μ „μ²΄'].str.extract(r'μ„μΈνΉλ³„μ‹\s+(\S+)')

    # κµ¬λ³„λ΅ λ‚¨λ…€ μΈκµ¬ ν•©μ‚°
    κµ¬λ³„_μ§‘κ³„ = μ„μΈ_df.groupby('κµ¬')[['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ', '2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ']].sum()
    κµ¬λ³„_μ§‘κ³„ = κµ¬λ³„_μ§‘κ³„.dropna()  # κµ¬ μ΄λ¦„ μ—†λ” ν–‰ μ κ±°

    # λΉ„μ¨ κ³„μ‚°
    κµ¬λ³„_μ§‘κ³„['λ‚¨μλΉ„μ¨(%)'] = (κµ¬λ³„_μ§‘κ³„['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'] / 
                           (κµ¬λ³„_μ§‘κ³„['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'] + κµ¬λ³„_μ§‘κ³„['2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ'])) * 100
    κµ¬λ³„_μ§‘κ³„['μ—¬μλΉ„μ¨(%)'] = 100 - κµ¬λ³„_μ§‘κ³„['λ‚¨μλΉ„μ¨(%)']

    # μ‹κ°ν™”λ¥Ό μ„ν• λ°μ΄ν„°ν”„λ μ„ μ¬κµ¬μ„±
    λΉ„μ¨_df = κµ¬λ³„_μ§‘κ³„[['λ‚¨μλΉ„μ¨(%)', 'μ—¬μλΉ„μ¨(%)']]
    λΉ„μ¨_df = λΉ„μ¨_df.round(1)

    st.subheader("μ„μΈμ‹ κµ¬λ³„ λ‚¨λ…€ μΈκµ¬ λΉ„μ¨ (%)")
    st.bar_chart(λΉ„μ¨_df)

    # λ°μ΄ν„°ν‘λ„ ν•¨κ» μ κ³µ
    with st.expander("π“‹ λ°μ΄ν„° λ³΄κΈ°"):
        st.dataframe(λΉ„μ¨_df)

if __name__ == '__main__':
    app()

