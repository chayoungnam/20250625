import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

def app():
    st.title("ν–‰μ •κµ¬μ—­λ³„ λ‚¨λ…€ μΈκµ¬ μ°¨μ΄ μ‹κ°ν™” (2025λ…„ 5μ›” κΈ°μ¤€)")

    # λ°μ΄ν„° λ¶λ¬μ¤κΈ°
    df = pd.read_csv('202505_202505_μ—°λ Ήλ³„μΈκµ¬ν„ν™©_μ›”κ°„ (1).csv', encoding='cp949')

    # ν–‰μ •κµ¬μ—­ μ΄λ¦„ μ „μ²λ¦¬
    df['ν–‰μ •κµ¬μ—­'] = df['ν–‰μ •κµ¬μ—­'].astype(str).str.split(' ').str[0]

    # μ‰Όν‘ μ κ±° λ° μ •μν• λ³€ν™
    df['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'] = df['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'].str.replace(',', '', regex=False).astype(int)
    df['2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ'] = df['2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ'].str.replace(',', '', regex=False).astype(int)

    # ν–‰μ •κµ¬μ—­ μ„ νƒ
    ν–‰μ •κµ¬μ—­_λ©λ΅ = df['ν–‰μ •κµ¬μ—­'].unique()
    μ„ νƒ_ν–‰μ •κµ¬μ—­ = st.selectbox("ν–‰μ •κµ¬μ—­μ„ μ„ νƒν•μ„Έμ”:", sorted(ν–‰μ •κµ¬μ—­_λ©λ΅))

    # μ„ νƒλ ν–‰μ •κµ¬μ—­μ λ‚¨λ…€ μΈκµ¬
    μ„ νƒ_λ°μ΄ν„° = df[df['ν–‰μ •κµ¬μ—­'] == μ„ νƒ_ν–‰μ •κµ¬μ—­]
    λ‚¨μ_μΈκµ¬ = μ„ νƒ_λ°μ΄ν„°['2025λ…„05μ›”_λ‚¨_μ΄μΈκµ¬μ'].sum()
    μ—¬μ_μΈκµ¬ = μ„ νƒ_λ°μ΄ν„°['2025λ…„05μ›”_μ—¬_μ΄μΈκµ¬μ'].sum()

    # μ‹κ°ν™”
    st.subheader(f"π“ {μ„ νƒ_ν–‰μ •κµ¬μ—­}μ λ‚¨λ…€ μΈκµ¬ λΉ„κµ")
    fig, ax = plt.subplots()
    ax.bar(['λ‚¨μ', 'μ—¬μ'], [λ‚¨μ_μΈκµ¬, μ—¬μ_μΈκµ¬])
    ax.set_ylabel('μΈκµ¬μ')
    ax.set_title(f'{μ„ νƒ_ν–‰μ •κµ¬μ—­}μ λ‚¨λ…€ μΈκµ¬ λΉ„κµ')
    st.pyplot(fig)

    # μ¶”κ°€ μ •λ³΄ ν‘μ‹
    μ°¨μ΄ = abs(λ‚¨μ_μΈκµ¬ - μ—¬μ_μΈκµ¬)
    λ”_λ§μ€_μ„±λ³„ = 'λ‚¨μ' if λ‚¨μ_μΈκµ¬ > μ—¬μ_μΈκµ¬ else 'μ—¬μ'
    st.write(f"π’΅ {μ„ νƒ_ν–‰μ •κµ¬μ—­}μ—μ„λ” {λ”_λ§μ€_μ„±λ³„} μΈκµ¬κ°€ {μ°¨μ΄:,}λ… λ” λ§μµλ‹λ‹¤.")

if __name__ == '__main__':
    app()
